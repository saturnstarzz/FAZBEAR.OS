<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fazbear OS - Multi-Core</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { 
            --theme-color: #00ff41; 
            --theme-glow: rgba(0, 255, 65, 0.4);
            --bg-color: #0a0a0a;
            --panel-bg: rgba(0, 0, 0, 0.9);
        }

        /* --- DEVELOPER MODE THEME --- */
        body.developer-mode { 
            --theme-color: #00d4ff; 
            --theme-glow: rgba(0, 212, 255, 0.6); 
            --bg-color: #000814;
            --panel-bg: rgba(0, 8, 20, 0.98);
        }
        body.developer-mode .content-panel { 
            clip-path: polygon(12px 0, 100% 0, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%, 0 12px);
            border-style: solid;
        }

        /* --- BASE UI --- */
        body {
            background-color: var(--bg-color);
            color: var(--theme-color);
            font-family: 'VT323', monospace;
            min-height: 100vh;
            transition: background 0.5s ease, color 0.5s ease;
            overflow-x: hidden;
            background-image: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
        }

        .content-panel { 
            border: 1px solid var(--theme-color); 
            background: var(--panel-bg); 
            box-shadow: 0 0 15px var(--theme-glow);
            padding: 1.5rem;
        }

        .nav-btn { 
            border: 1px solid var(--theme-color); 
            padding: 6px 16px; 
            text-transform: uppercase; 
            font-weight: bold;
            transition: all 0.2s;
            background: rgba(0,0,0,0.5);
            font-size: 1.1rem;
        }
        .nav-btn:hover { background: var(--theme-color); color: black; }
        .nav-btn.active { background: var(--theme-color); color: black; box-shadow: 0 0 10px var(--theme-glow); }

        input { 
            background: black; 
            border: 1px solid var(--theme-color); 
            color: var(--theme-color); 
            padding: 12px; 
            outline: none; 
            width: 100%; 
            font-family: 'VT323', monospace; 
            font-size: 1.2rem;
        }
        
        .dev-node { display: none; }
        body.developer-mode .dev-node { display: block; }

        /* Login Assist for Mobile */
        #mobile-input-trigger {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }

        /* Button Enhancement */
        .primary-btn {
            background: var(--theme-color);
            color: black;
            box-shadow: 0 0 20px var(--theme-glow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow: none;
        }
        .primary-btn:hover {
            transform: scale(1.02);
            filter: brightness(1.2);
        }

        #camera-feed {
            background: #000;
            position: relative;
            overflow: hidden;
        }
        .scanline {
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            position: absolute;
            animation: scan 4s linear infinite;
        }
        @keyframes scan { from { top: 0; } to { top: 100%; } }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="fixed inset-0 bg-black/98 z-[10001] flex items-center justify-center p-4">
        <div class="max-w-md w-full border-2 border-current p-8 bg-black shadow-[0_0_50px_rgba(0,0,0,1)]">
            <h2 class="text-4xl mb-6 uppercase font-bold tracking-tighter italic border-b-2 border-current">SYSTEM_ACCESS</h2>
            <div class="space-y-6">
                <div>
                    <label class="text-xs opacity-70 block mb-1 tracking-widest">API_KEY (GEMINI)</label>
                    <input type="password" id="api-key-input" placeholder="Enter key...">
                </div>
                <div>
                    <label class="text-xs opacity-70 block mb-1 tracking-widest">OVERRIDE_SEQUENCE</label>
                    <input type="password" id="dev-password-input" placeholder="********">
                </div>
                <button onclick="handleAuth()" class="primary-btn w-full font-bold py-5 text-xl tracking-[0.2em] uppercase">
                    MOUNT_CORE
                </button>
                <p class="text-[10px] text-center opacity-40 uppercase">Unauthorized access is punishable by permanent termination.</p>
            </div>
        </div>
    </div>

    <!-- STARTUP SCREEN -->
    <div id="login-screen" class="fixed inset-0 flex flex-col items-center justify-center bg-black z-[10000]" onclick="focusMobileInput()">
        <!-- Invisible input to catch mobile keyboard -->
        <input type="text" id="mobile-input-trigger" autocomplete="off" ontouchstart="focusMobileInput()">
        
        <div class="max-w-md w-full border-2 border-current p-12 text-center pointer-events-none">
            <h2 class="text-6xl uppercase font-bold tracking-tighter mb-8">FAZBEAR_OS</h2>
            <div class="bg-black border-2 border-current p-6 min-h-[80px] flex items-center justify-center mb-4">
                <span id="name-display" class="text-4xl tracking-[0.3em] font-bold"></span>
            </div>
            <p class="text-xs opacity-50 mb-8 animate-pulse">[ TAP SCREEN TO TYPE ]</p>
            <button id="accept-btn" class="w-full border-2 border-current py-4 opacity-0 transition-opacity font-bold uppercase hover:bg-white/5 pointer-events-auto" onclick="startOS()">Initialize</button>
        </div>
    </div>

    <!-- UI ROOT -->
    <div id="terminal-ui" class="hidden max-w-7xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-end border-b-2 border-current pb-4 mb-6">
            <div>
                <h1 class="text-6xl md:text-7xl font-bold tracking-tighter leading-none">FAZ_OS_V4</h1>
                <p class="text-lg md:text-xl opacity-60 italic" id="status-line">TERMINAL_ACTIVE</p>
            </div>
            <div class="text-right mt-4 md:mt-0 w-full md:w-auto flex justify-between md:block items-center">
                <p class="text-xl md:text-2xl font-bold uppercase leading-none">CLEARANCE: <span id="level-display">---</span></p>
                <button onclick="document.getElementById('auth-modal').style.display='flex'" class="text-xs border border-current px-3 py-1 md:mt-1 hover:bg-white/10 uppercase font-bold">RE-AUTH</button>
            </div>
        </header>

        <!-- NAVIGATION -->
        <nav id="nav-bar" class="flex flex-wrap gap-2 mb-8 border-b border-current/20 pb-4">
            <button data-page="home" class="nav-btn active">DASHBOARD</button>
            <button data-page="maintenance" class="nav-btn">MAINTENANCE</button>
            
            <!-- Dev Only Tabs -->
            <button data-page="kernel" class="nav-btn dev-node">KERNEL_LOGS</button>
            <button data-page="ledger" class="nav-btn dev-node">SYSTEM_LEDGER</button>
            <button data-page="hardware" class="nav-btn dev-node">HARDWARE_DUMP</button>

            <!-- Universal -->
            <button data-page="manifest" class="nav-btn">MANIFEST</button>
            <button data-page="chat" class="nav-btn">HANDUNIT</button>
        </nav>

        <main id="content-root">
            <!-- DASHBOARD -->
            <section id="page-home" class="page-sec">
                <div class="content-panel border-l-[16px] border-l-current">
                    <h2 class="text-4xl font-bold mb-4 uppercase">System Overview</h2>
                    <p id="context-msg" class="text-2xl opacity-70 mb-8 italic">"Welcome back, Eggs Benedict."</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="p-6 border border-current bg-current/5">
                            <h4 class="text-xs uppercase mb-2">POWER_RESERVE</h4>
                            <div class="text-4xl font-bold" id="batt-val">SYNCING...</div>
                        </div>
                        <div class="p-6 border border-current bg-current/5">
                            <h4 class="text-xs uppercase mb-2">THERMAL_STATE</h4>
                            <div class="text-4xl font-bold">STABLE</div>
                        </div>
                        <div class="p-6 border border-current bg-current/5">
                            <h4 class="text-xs uppercase mb-2">NETWORK_SYNC</h4>
                            <div class="text-4xl font-bold text-yellow-500">LOCAL_ONLY</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- MAINTENANCE -->
            <section id="page-maintenance" class="page-sec hidden">
                <div class="content-panel">
                    <h2 class="text-3xl font-bold mb-6 uppercase tracking-wider">ðŸ›  FACILITY_MAINTENANCE</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 border border-current/30 bg-black">
                            <h3 class="font-bold mb-2">STAGE_01_ANALOG</h3>
                            <div class="flex justify-between items-center">
                                <span>Servo Response</span>
                                <span class="text-green-500 font-bold uppercase">Pass</span>
                            </div>
                        </div>
                        <div class="p-4 border border-current/30 bg-black">
                            <h3 class="font-bold mb-2">VENT_SYSTEM_04</h3>
                            <div class="flex justify-between items-center">
                                <span>Airflow Rate</span>
                                <span class="text-red-500 font-bold uppercase">Low</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- KERNEL (DEV) -->
            <section id="page-kernel" class="page-sec hidden">
                <div class="content-panel font-mono text-xs">
                    <h2 class="text-2xl font-bold mb-4 text-blue-400">0x00_FS_CORE_DUMP</h2>
                    <div id="kernel-box" class="h-64 overflow-y-auto bg-black/50 p-4 space-y-1"></div>
                </div>
            </section>

            <!-- LEDGER (DEV) -->
            <section id="page-ledger" class="page-sec hidden">
                <div class="content-panel">
                    <h2 class="text-2xl font-bold mb-4 text-blue-400 uppercase">Faz_Finance_Unaudited</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-current/10">
                                <tr><th class="p-2">REF_ID</th><th>PAYEE</th><th>DESC</th><th>AMT</th></tr>
                            </thead>
                            <tbody id="ledger-body"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- MANIFEST -->
            <section id="page-manifest" class="page-sec hidden">
                <div class="content-panel mb-6">
                    <div class="flex flex-col md:flex-row gap-2">
                        <input type="text" id="lore-input" placeholder="Query Personnel or Entity Records..." onkeypress="if(event.key==='Enter') loreSearch()">
                        <button onclick="loreSearch()" class="primary-btn px-8 font-bold hover:brightness-110 py-3 md:py-0">SEARCH</button>
                    </div>
                </div>
                <div id="lore-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </section>

            <!-- CHAT -->
            <section id="page-chat" class="page-sec hidden">
                <div class="content-panel h-[350px] md:h-[400px] overflow-y-auto mb-4" id="chat-box"></div>
                <div class="flex flex-col md:flex-row gap-2">
                    <input type="text" id="chat-input" placeholder="Awaiting instruction..." onkeypress="if(event.key==='Enter') sendMsg()">
                    <button onclick="sendMsg()" class="primary-btn px-8 font-bold hover:brightness-110 py-3 md:py-0 uppercase">Exec</button>
                </div>
            </section>
        </main>
    </div>

    <script>
        let API_KEY = localStorage.getItem('fz_key') || "";
        let DEV_MODE = false;

        const typedTarget = "EGGS BENEDICT";
        let typedVal = "";
        let typedIdx = 0;

        // MOBILE INPUT HANDLER
        function focusMobileInput() {
            const input = document.getElementById('mobile-input-trigger');
            input.focus();
        }

        document.getElementById('mobile-input-trigger').addEventListener('input', (e) => {
            const newVal = e.target.value;
            if (newVal.length > 0) {
                simulateType();
            }
            e.target.value = ""; 
        });

        function simulateType() {
            if (typedIdx < typedTarget.length) {
                typedVal += typedTarget[typedIdx];
                typedIdx++;
                document.getElementById('name-display').innerText = typedVal;
                if (typedIdx === typedTarget.length) {
                    document.getElementById('accept-btn').style.opacity = '1';
                }
            }
        }

        // AUTH HANDLER
        function handleAuth() {
            const key = document.getElementById('api-key-input').value.trim();
            const pass = document.getElementById('dev-password-input').value.trim();
            
            API_KEY = key;
            localStorage.setItem('fz_key', key);

            if (pass === "BIT_OF_83") {
                DEV_MODE = true;
            } else {
                DEV_MODE = false;
            }

            document.getElementById('auth-modal').style.display = 'none';
            refreshUI();
        }

        function refreshUI() {
            document.body.classList.remove('developer-mode');
            
            if (DEV_MODE) {
                document.body.classList.add('developer-mode');
                document.getElementById('level-display').innerText = "DEVELOPER";
                populateDevData();
            } else {
                document.getElementById('level-display').innerText = "TECHNICIAN";
            }

            switchTab('home');
        }

        function populateDevData() {
            const logs = [
                "[0.00] Mounting Faz-Kernel V4.0.2...",
                "[0.42] Found entity: GOLDEN_BEAR. Process isolated.",
                "[1.15] Warning: Memory leak in personality chip.",
                "[2.30] Security override detected in Sector 4.",
                "[4.01] Running background process: RemnantCollection.exe"
            ];
            document.getElementById('kernel-box').innerHTML = logs.map(l => `<div>> ${l}</div>`).join('');

            const vendors = ["Afton Robotics", "Burial Services", "Local PD", "Silversmith Settlement"];
            let rows = "";
            for(let i=0; i<8; i++) {
                rows += `<tr class="border-b border-current/10">
                    <td class="p-2">#FX-${100+i}</td>
                    <td>${vendors[i%vendors.length]}</td>
                    <td class="text-xs">UNAUDITED_SETTLEMENT</td>
                    <td class="text-red-400">-$${(Math.random()*8000).toFixed(2)}</td>
                </tr>`;
            }
            document.getElementById('ledger-body').innerHTML = rows;
        }

        // NAVIGATION
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const pageId = btn.getAttribute('data-page');
                switchTab(pageId);
                
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        function switchTab(id) {
            document.querySelectorAll('.page-sec').forEach(p => p.classList.add('hidden'));
            const target = document.getElementById('page-' + id);
            if (target) target.classList.remove('hidden');
        }

        // AI FEATURES
        async function loreSearch() {
            const input = document.getElementById('lore-input');
            const results = document.getElementById('lore-results');
            if (!input.value) return;

            const loader = document.createElement('div');
            loader.className = "col-span-full content-panel text-center animate-pulse";
            loader.innerText = "ACCESSING_ARCHIVE...";
            results.prepend(loader);

            const res = await callGemini(`FNAF Lore: ${input.value}. Respond as HandUnit.`);
            loader.remove();

            if (res) {
                results.innerHTML = `<div class="content-panel border-t-4 border-t-current">
                    <h4 class="text-2xl font-bold mb-2 uppercase">${input.value}</h4>
                    <p class="text-sm opacity-80">${res}</p>
                </div>` + results.innerHTML;
            }
            input.value = "";
        }

        async function sendMsg() {
            const input = document.getElementById('chat-input');
            const box = document.getElementById('chat-box');
            if (!input.value) return;

            box.innerHTML += `<div class="mb-2">USER: ${input.value}</div>`;
            const reply = await callGemini(input.value);
            box.innerHTML += `<div class="mb-4 opacity-50">SYSTEM: ${reply}</div>`;
            input.value = "";
            box.scrollTop = box.scrollHeight;
        }

        async function callGemini(p) {
            if (!API_KEY) return "ERROR: API_KEY_REQUIRED";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{parts: [{text: p}]}], systemInstruction: {parts: [{text: `You are HandUnit, the sarcastic AI assistant for Fazbear Entertainment.`}]}})
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "NO_RESPONSE";
            } catch(e) { return "SIGNAL_INTERRUPTED..."; }
        }

        // KEYBOARD LISTENER (Desktop)
        window.addEventListener('keydown', (e) => {
            if (document.getElementById('login-screen').style.display !== 'none' && e.key.length === 1) {
                simulateType();
            }
        });

        function startOS() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('terminal-ui').classList.remove('hidden');
            refreshUI();
            initBatt();
        }

        // --- BATTERY SYNC LOGIC ---
        async function initBatt() {
            const battDisplay = document.getElementById('batt-val');
            try {
                if ('getBattery' in navigator) {
                    const battery = await navigator.getBattery();
                    
                    const updateBatteryUI = () => {
                        const level = Math.round(battery.level * 100);
                        battDisplay.innerText = `${level}%`;
                        
                        // Optional: Visual warning if low
                        if (level < 20) {
                            battDisplay.classList.add('text-red-500', 'animate-pulse');
                        } else {
                            battDisplay.classList.remove('text-red-500', 'animate-pulse');
                        }
                    };

                    // Initial call and event listeners
                    updateBatteryUI();
                    battery.addEventListener('levelchange', updateBatteryUI);
                    battery.addEventListener('chargingchange', updateBatteryUI);
                } else {
                    // Fallback for browsers that don't support the Battery API
                    battDisplay.innerText = "EXT_PWR";
                }
            } catch (error) {
                console.warn("Battery API restricted or unavailable:", error);
                battDisplay.innerText = "100%"; 
            }
        }
    </script>
</body>
</html>

